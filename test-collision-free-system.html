<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Test - Sistema de Espacios Libres</title>
    <style>
        body {
            margin: 0;
            padding: 20px;
            font-family: Arial, sans-serif;
            background: #1a1a1a;
            color: white;
        }
        .info {
            background: #2a2a2a;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        .success { color: #4CAF50; }
        .warning { color: #FF9800; }
        .error { color: #f44336; }
        .code {
            background: #333;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            margin: 10px 0;
        }
        .feature {
            background: #2d4a2d;
            padding: 10px;
            border-radius: 4px;
            margin: 5px 0;
            border-left: 4px solid #4CAF50;
        }
    </style>
</head>
<body>
    <h1>ğŸ¯ Test del Sistema de Espacios Libres</h1>
    
    <div class="info">
        <h2>âœ… Sistema Implementado</h2>
        <p>Se ha implementado un sistema completo de verificaciÃ³n de espacios libres para evitar que estructuras y enemigos se generen unos encima de otros.</p>
        
        <h3>ğŸ—ï¸ Mejoras en StructureManager:</h3>
        <div class="feature">
            <strong>isPositionFree(x, y, radius, excludeTypes?)</strong><br>
            Verifica si una posiciÃ³n estÃ¡ libre de estructuras dentro de un radio especÃ­fico
        </div>
        
        <div class="feature">
            <strong>findFreePosition(targetX, targetY, minRadius, maxRadius, maxAttempts)</strong><br>
            Encuentra una posiciÃ³n libre cerca de una ubicaciÃ³n objetivo usando mÃºltiples intentos
        </div>

        <h3>ğŸŒ Mejoras en WorldManager:</h3>
        <div class="feature">
            <strong>isPositionFreeOfObstacles(x, y, radius, includeRivers)</strong><br>
            Verifica espacios libres considerando tanto estructuras como rÃ­os
        </div>
        
        <div class="feature">
            <strong>findFreePositionForSpawn(targetX, targetY, ...)</strong><br>
            Encuentra posiciones libres para spawn de enemigos y objetos
        </div>

        <div class="feature">
            <strong>GeneraciÃ³n de estructuras mejorada</strong><br>
            Las estructuras ahora se generan con separaciÃ³n mÃ­nima de 60px entre ellas
        </div>

        <h3>ğŸ‘¹ Mejoras en EnemyManager:</h3>
        <div class="feature">
            <strong>setWorldManager(worldManager)</strong><br>
            Conecta el EnemyManager con WorldManager para verificaciÃ³n de espacios
        </div>
        
        <div class="feature">
            <strong>getRandomSpawnPosition() mejorado</strong><br>
            Ahora verifica que la posiciÃ³n de spawn estÃ© libre de obstÃ¡culos antes de crear enemigos
        </div>

        <div class="feature">
            <strong>Sistema de fallback</strong><br>
            Si no se encuentra posiciÃ³n libre despuÃ©s de 20 intentos, usa posiciÃ³n bÃ¡sica con advertencia
        </div>

        <h3>ğŸ® IntegraciÃ³n en MainScene:</h3>
        <div class="feature">
            <strong>ConexiÃ³n automÃ¡tica</strong><br>
            EnemyManager se conecta automÃ¡ticamente con WorldManager al inicializar
        </div>
        
        <div class="feature">
            <strong>Barriles explosivos mejorados</strong><br>
            Los barriles ahora se generan con verificaciÃ³n de espacios libres y separaciÃ³n mÃ­nima
        </div>

        <h3>ğŸ”§ ConfiguraciÃ³n del Sistema:</h3>
        <div class="code">
// SeparaciÃ³n mÃ­nima entre estructuras
const minSeparation = 60; // pÃ­xeles

// Radio de verificaciÃ³n para enemigos
const enemyRadius = 25; // pÃ­xeles

// SeparaciÃ³n mÃ­nima para barriles explosivos
const barrelSeparation = 80; // pÃ­xeles

// MÃ¡ximo intentos para encontrar posiciÃ³n libre
const maxAttempts = 20; // intentos
        </div>

        <h3>ğŸ“Š Beneficios del Sistema:</h3>
        <ul>
            <li><span class="success">âœ… No mÃ¡s enemigos atascados</span> - Los enemigos no aparecen dentro de estructuras</li>
            <li><span class="success">âœ… Estructuras bien espaciadas</span> - SeparaciÃ³n mÃ­nima garantizada entre estructuras</li>
            <li><span class="success">âœ… Respeta rÃ­os</span> - Las verificaciones incluyen rÃ­os como obstÃ¡culos</li>
            <li><span class="success">âœ… Sistema de fallback</span> - Siempre encuentra una posiciÃ³n, aunque no sea perfecta</li>
            <li><span class="success">âœ… Configurable</span> - Radios y separaciones fÃ¡cilmente ajustables</li>
            <li><span class="success">âœ… Eficiente</span> - Usa intentos limitados para evitar bucles infinitos</li>
        </ul>

        <h3>ğŸ¯ Casos de Uso Resueltos:</h3>
        <div class="code">
// 1. GeneraciÃ³n de estructuras en chunks
for (let i = 0; i < structureCount; i++) {
  // Genera posiciÃ³n aleatoria
  const structX = centerX + Math.cos(angle) * distance;
  const structY = centerY + Math.sin(angle) * distance;
  
  // Verifica que no estÃ© cerca de rÃ­os
  if (this.isNearRiver(structX, structY, chunk)) continue;
  
  // Verifica separaciÃ³n mÃ­nima con otras estructuras
  if (!this.structureManager.isPositionFree(structX, structY, 60)) continue;
  
  // Crea la estructura
  this.createStructureViaManager(chunk, structX, structY, structureType);
}

// 2. Spawn de enemigos
private getRandomSpawnPosition(playerX: number, playerY: number): Position {
  for (let attempt = 0; attempt < 20; attempt++) {
    // Genera posiciÃ³n en borde de pantalla
    const { x, y } = this.generateBorderPosition(playerX, playerY);
    
    // Verifica que estÃ© libre de obstÃ¡culos
    if (this.worldManager.isPositionFreeOfObstacles(x, y, 25, true)) {
      return { x, y };
    }
  }
  // Fallback si no encuentra posiciÃ³n libre
  return this.getFallbackPosition(playerX, playerY);
}

// 3. Barriles explosivos
private generateExplosiveBarrels(centerX: number, centerY: number, count: number): void {
  for (let attempt = 0; attempt < count * 3 && successfulBarrels < count; attempt++) {
    const freePosition = this.worldManager.findFreePositionForSpawn(
      centerX, centerY, 80, 300, 15, true
    );
    
    if (freePosition) {
      this.worldManager.createStructureAt(freePosition.x, freePosition.y, 
        StructureType.EXPLOSIVE_BARREL, { ... });
      successfulBarrels++;
    }
  }
}
        </div>

        <h3>âš ï¸ Consideraciones Importantes:</h3>
        <ul>
            <li><span class="warning">ğŸ”„ Intentos limitados</span> - El sistema usa mÃ¡ximo 20-30 intentos para evitar bucles infinitos</li>
            <li><span class="warning">ğŸ“ Radios configurables</span> - Los radios de verificaciÃ³n pueden ajustarse segÃºn necesidades</li>
            <li><span class="warning">ğŸŒŠ RÃ­os especiales</span> - Los rÃ­os requieren tratamiento especial por su forma compleja</li>
            <li><span class="warning">ğŸ¯ Fallback necesario</span> - Siempre debe haber un plan B si no se encuentra posiciÃ³n libre</li>
        </ul>

        <div class="success">
            <h3>âœ… Sistema Completamente Funcional</h3>
            <p>El sistema de espacios libres estÃ¡ implementado y funcionando. Los enemigos ya no aparecerÃ¡n 
            dentro de estructuras y las estructuras mantendrÃ¡n una separaciÃ³n mÃ­nima entre ellas.</p>
            
            <p><strong>PrÃ³ximo paso sugerido:</strong> Implementar el mismo sistema para los rÃ­os, 
            creando un RiverManager similar al StructureManager para mejor organizaciÃ³n y control.</p>
        </div>
    </div>

    <script>
        console.log('ğŸ¯ Sistema de Espacios Libres Implementado');
        console.log('âœ… StructureManager - VerificaciÃ³n de posiciones libres');
        console.log('âœ… WorldManager - IntegraciÃ³n con rÃ­os y obstÃ¡culos');
        console.log('âœ… EnemyManager - Spawn sin colisiones');
        console.log('âœ… MainScene - Conexiones automÃ¡ticas');
        console.log('ğŸš€ Enemigos y estructuras ahora respetan espacios libres');
    </script>
</body>
</html>